try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},s=(new e.Error).stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="3441512d-55fa-4039-bc35-f8ed4e1df453",e._sentryDebugIdIdentifier="sentry-dbid-3441512d-55fa-4039-bc35-f8ed4e1df453")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7975],{23055:(e,s,n)=>{n.d(s,{q:()=>c});var i=n(6029),t=n(59309),l=n(22070),a=n(88131),r=n(12482),o=n(90944);let c=e=>{let{workspaceId:s,colorScheme:n}=e,{t:c}=(0,o.WD)(),{data:d}=(0,r.I)(t.id.billing.getBillingPortalUrl.queryOptions({workspaceId:s},{meta:{errorContext:"Error getting billing portal url"}}));return(0,i.jsx)(l.$,{as:a.N,href:null==d?void 0:d.billingPortalUrl,isLoading:!d,colorScheme:n,children:c("billing.billingPortalButton.label")})}},67975:(e,s,n)=>{n.d(s,{a:()=>nr});var i=n(6029),t=n(48077),l=n(44444),a=n(39349),r=n(90170),o=n(47827),c=n(4227),d=n(59309),u=n(79596),p=n(1069),h=n(22070),x=n(28144),j=n(94283),m=n(20644),g=n(15281),f=n(12482),b=n(90944);let v=e=>{var s;let{currentWorkspace:n,isLoggingOut:a,onWorkspaceSelected:r,onLogoutClick:o,onCreateNewWorkspaceClick:v}=e,{t:y}=(0,b.WD)(),{data:w}=(0,f.I)(d.id.workspace.listWorkspaces.queryOptions()),k=null!=(s=null==w?void 0:w.workspaces)?s:[];return(0,i.jsxs)(u.W,{placement:"bottom-end",children:[(0,i.jsx)(p.I,{as:h.$,variant:"outline",px:"2",children:(0,i.jsxs)(x.z,{children:[!a&&n&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j.E,{isTruncated:!0,maxW:"300px",children:n.name}),(0,i.jsx)(c.a,{plan:n.plan})]}),(0,i.jsx)(l.YJ,{transform:"rotate(-90deg)"})]})}),(0,i.jsxs)(m.c,{children:[k.map(e=>(0,i.jsx)(g.D,{onClick:()=>r(e.id),children:(0,i.jsxs)(x.z,{justify:"space-between",w:"full",children:[(0,i.jsxs)(x.z,{children:[(0,i.jsx)(t.e,{icon:e.icon,boxSize:"16px",defaultIcon:l.jj}),(0,i.jsx)(j.E,{isTruncated:!0,maxW:"250px",children:e.name}),(0,i.jsx)(c.a,{plan:e.plan})]}),e.id===(null==n?void 0:n.id)&&(0,i.jsx)(l.Sr,{})]})},e.id)),(0,i.jsx)(g.D,{onClick:v,icon:(0,i.jsx)(l.c1,{}),children:y("workspace.dropdown.newButton.label")}),(0,i.jsx)(g.D,{onClick:o,icon:(0,i.jsx)(l.uV,{}),color:"orange.500",children:y("workspace.dropdown.logoutButton.label")})]})]})};var y=n(29328),w=n(55729),k=n(83489),S=n(85678),C=n(38859),E=n(70205),z=n(13808),I=n(23055);let T=e=>{var s,n,t;let{workspace:l}=e,{t:a}=(0,b.WD)(),{data:r}=(0,f.I)(d.id.billing.getSubscription.queryOptions({workspaceId:l.id})),o=(l.plan===z.cw.STARTER||l.plan===z.cw.PRO)&&l.stripeId;return(0,i.jsxs)(y.B,{spacing:"4",children:[(0,i.jsx)(S.D,{fontSize:"3xl",children:a("billing.currentSubscription.heading")}),(0,i.jsxs)(x.z,{"data-testid":"current-subscription",children:[(0,i.jsxs)(j.E,{children:[a("billing.currentSubscription.subheading")," "]}),(0,i.jsx)(c.a,{plan:l.plan}),(null==r||null==(s=r.subscription)?void 0:s.cancelDate)&&(0,i.jsxs)(j.E,{fontSize:"sm",children:["(",a("billing.currentSubscription.cancelDate")," ",r.subscription.cancelDate.toDateString(),")"]})]}),(null==r||null==(n=r.subscription)?void 0:n.status)==="past_due"&&(0,i.jsxs)(C.F,{fontSize:"sm",status:"error",children:[(0,i.jsx)(E._,{}),a("billing.currentSubscription.pastDueAlert")]}),o&&(0,i.jsx)(I.q,{workspaceId:l.id,colorScheme:(null==r||null==(t=r.subscription)?void 0:t.status)==="past_due"?"blue":void 0})]})};var D=n(9969),B=n(87796),M=n(67165),L=n(28718),O=n(99712),W=n(62679),K=n(86336),$=n(58972),N=n(42955),A=n(81251),_=n(82203),P=n.n(_);let U=e=>{let{workspaceId:s}=e,{t:n}=(0,b.WD)(),{data:t,status:a}=(0,f.I)(d.id.billing.listInvoices.queryOptions({workspaceId:s}));return(0,i.jsxs)(y.B,{spacing:6,children:[(0,i.jsx)(S.D,{fontSize:"3xl",children:n("billing.invoices.heading")}),(null==t?void 0:t.invoices.length)===0&&"pending"!==a?(0,i.jsx)(j.E,{children:n("billing.invoices.empty")}):(0,i.jsx)(D.K,{children:(0,i.jsxs)(B.X,{children:[(0,i.jsx)(M.d,{children:(0,i.jsxs)(L.Tr,{children:[(0,i.jsx)(O.Th,{w:"0"}),(0,i.jsx)(O.Th,{children:"#"}),(0,i.jsx)(O.Th,{children:n("billing.invoices.paidAt")}),(0,i.jsx)(O.Th,{children:n("billing.invoices.subtotal")}),(0,i.jsx)(O.Th,{w:"0"})]})}),(0,i.jsxs)(W.N,{children:[null==t?void 0:t.invoices.map(e=>(0,i.jsxs)(L.Tr,{children:[(0,i.jsx)(K.Td,{children:(0,i.jsx)(l.oS,{})}),(0,i.jsx)(K.Td,{children:e.id}),(0,i.jsx)(K.Td,{children:e.date?new Date(1e3*e.date).toDateString():""}),(0,i.jsx)(K.Td,{children:R(e.amount,e.currency)}),(0,i.jsx)(K.Td,{children:e.url&&(0,i.jsx)($.K,{as:P(),size:"xs",icon:(0,i.jsx)(l.s3,{}),variant:"outline",href:e.url,target:"_blank","aria-label":"Download invoice"})})]},e.id)),"pending"===a&&Array.from({length:3}).map((e,s)=>(0,i.jsxs)(L.Tr,{children:[(0,i.jsx)(K.Td,{children:(0,i.jsx)(N.S,{isDisabled:!0})}),(0,i.jsx)(K.Td,{children:(0,i.jsx)(A.E,{h:"5px"})}),(0,i.jsx)(K.Td,{children:(0,i.jsx)(A.E,{h:"5px"})})]},s))]})]})})]})},R=(e,s)=>new Intl.NumberFormat("en-US",{style:"currency",currency:s}).format(e/100);var V=n(49377),q=n(80853),F=n(14775);let H=e=>{let{plan:s,customChatsLimit:n}=e;return n||(s===z.cw.UNLIMITED||s===z.cw.LIFETIME||s===z.cw.OFFERED||s===z.cw.CUSTOM?"inf":F.IH[s])};var G=n(2283);let J=e=>{var s;let{workspace:n}=e,{t}=(0,b.WD)(),{data:l,isLoading:a}=(0,f.I)(d.id.billing.getUsage.queryOptions({workspaceId:n.id})),r=null!=(s=null==l?void 0:l.totalChatsUsed)?s:0,o=H(n),c="inf"===o?0:Math.round(r/o*100);return(0,i.jsxs)(y.B,{spacing:6,children:[(0,i.jsx)(S.D,{fontSize:"3xl",children:t("billing.usage.heading")}),(0,i.jsxs)(y.B,{spacing:3,children:[(0,i.jsxs)(V.s,{justifyContent:"space-between",children:[(0,i.jsxs)(x.z,{children:[(0,i.jsx)(S.D,{fontSize:"xl",as:"h3",children:t("billing.usage.chats.heading")}),(0,i.jsx)(j.E,{fontSize:"sm",fontStyle:"italic",color:"gray.500",children:t("billing.usage.chats.resetsOn",{date:null==l?void 0:l.resetsAt.toLocaleDateString()})})]}),(0,i.jsxs)(x.z,{children:[(0,i.jsx)(A.E,{fontWeight:"bold",isLoaded:!a,h:a?"5px":"auto",children:(0,G.rL)(r)}),(0,i.jsxs)(j.E,{children:["/"," ","inf"===o?t("billing.usage.unlimited"):(0,G.rL)(o)]})]})]}),(0,i.jsx)(q.k,{h:"5px",value:c,rounded:"full",isIndeterminate:a,colorScheme:"orange"})]})]})},Q=()=>{let{workspace:e,currentUserMode:s}=(0,o.h)();return e?(0,i.jsxs)(y.B,{spacing:"10",w:"full",children:[(0,i.jsx)(J,{workspace:e}),(0,i.jsxs)(y.B,{spacing:"4",children:[(0,i.jsx)(T,{workspace:e}),(0,i.jsx)(k.c,{workspace:e,currentUserMode:s})]}),e.stripeId&&(0,i.jsx)(U,{workspaceId:e.id})]}):null};var Y=n(20749),X=n(3495);let Z=e=>(0,i.jsxs)(X.I,{viewBox:"0 0 400 400",...e,children:[(0,i.jsx)("path",{style:{fillRule:"evenodd",clipRule:"evenodd",fill:"#635bff"},d:"M0 0h400v400H0z"}),(0,i.jsx)("path",{d:"M184.4 155.5c0-9.4 7.7-13.1 20.5-13.1 18.4 0 41.6 5.6 60 15.5v-56.8C244.8 93.1 225 90 205 90c-49.1 0-81.7 25.6-81.7 68.4 0 66.7 91.9 56.1 91.9 84.9 0 11.1-9.7 14.7-23.2 14.7-20.1 0-45.7-8.2-66-19.3v57.5c22.5 9.7 45.2 13.8 66 13.8 50.3 0 84.9-24.9 84.9-68.2-.4-72-92.5-59.2-92.5-86.3z",style:{fillRule:"evenodd",clipRule:"evenodd",fill:"#fff"}})]});var ee=n(71426),es=n(9533),en=n(3827),ei=n(21638),et=n(94858),el=n(46370),ea=n(66737),er=n(49224),eo=n(58935),ec=n(73925),ed=n(10646),eu=n(16932),ep=n(36948),eh=n(62790),ex=n(20894),ej=n(63203),em=n(37516),eg=n(99423),ef=n(84424),eb=n(1970),ev=n(52580),ey=n(75262),ew=n(42302),ek=n(97699),eS=n(88079),eC=n(64153),eE=n(23972),ez=n(86917),eI=n(50239),eT=n(23598),eD=n(68282),eB=n(48810),eM=n(31173),eL=n(92366),eO=n(30831),eW=n(47794),eK=n(43684),e$=n(36908),eN=n(82588),eA=n(48739),e_=n(66342),eP=n(73938),eU=n(66227),eR=n(46846),eV=n(94402),eq=n(57784),eF=n(38538);let eH={[eW.U.id]:eK.G,[eg.u.id]:ef.w,[ey.Q.id]:ew.k,[eT.S.id]:eD.w,[ek.r.id]:eS.p,[eh.M.id]:ex.q,[eR.c.id]:eV.w,[eL.H.id]:eO.t,[eB.$.id]:eM.p,[eP.$.id]:eU.r,[ez.z.id]:eI.B,[eq.o.id]:eF.q,[eA.o.id]:e_.E,[e$.M.id]:eN.e,[eb.I.id]:ev.G,[ej.Y.id]:em.e,[eC.K.id]:eE.E};var eG=n(90695);let eJ=eG.z.object({id:eG.z.string(),createdAt:eG.z.date(),name:eG.z.string(),iv:eG.z.string()}),eQ=eG.z.object({type:eG.z.literal("whatsApp"),data:eG.z.object({systemUserAccessToken:eG.z.string(),phoneNumberId:eG.z.string()})}).merge(eJ),eY=eG.z.object({type:eG.z.literal("stripe"),data:eG.z.object({live:eG.z.object({secretKey:eG.z.string(),publicKey:eG.z.string()}),test:eG.z.object({secretKey:eG.z.string().optional(),publicKey:eG.z.string().optional()})})}).merge(eJ),eX=eG.z.object({type:eG.z.literal("google sheets"),data:eG.z.object({refresh_token:eG.z.string().nullish(),expiry_date:eG.z.number().nullish(),access_token:eG.z.string().nullish(),token_type:eG.z.string().nullish(),id_token:eG.z.string().nullish(),scope:eG.z.string().optional()})}).merge(eJ),eZ=eG.z.object({type:eG.z.literal("smtp"),data:eG.z.object({host:eG.z.string().optional(),username:eG.z.string().optional(),password:eG.z.string().optional(),isTlsEnabled:eG.z.boolean().optional(),port:eG.z.number(),from:eG.z.object({email:eG.z.string().optional(),name:eG.z.string().optional()})})}).merge(eJ);eG.z.discriminatedUnion("type",[eZ,eX,eY,eQ,...Object.values(eH)]);let e0=["smtp","google sheets","stripe","whatsApp",...Object.keys(eH)];eG.z.enum(e0);var e1=n(59391),e4=n(59958),e2=n(90682),e9=n(37191),e5=n(22194),e3=n(50427),e8=n(57470),e6=n(7959),e7=n(86747),se=n(84179),ss=n(75534),sn=n(31445);let si=e=>{var s,n,t,l;let{credentialsId:a,onUpdate:c}=e,{t:u}=(0,b.WD)(),{user:p}=(0,r.J)(),{workspace:m}=(0,o.h)(),[g,v]=(0,w.useState)(!1),[k,S]=(0,w.useState)(),{data:C}=(0,f.I)(d.id.credentials.getCredentials.queryOptions({scope:"workspace",credentialsId:a,workspaceId:m.id},{enabled:!!(null==m?void 0:m.id)}));(0,w.useEffect)(()=>{C&&!k&&S({name:C.name,live:C.data.live,test:C.data.test})},[C,k]);let{mutate:E}=(0,eu.n)(d.id.credentials.updateCredentials.mutationOptions({onMutate:()=>v(!0),onSettled:()=>v(!1),onSuccess:()=>{c()}})),z=async e=>{e.preventDefault(),(null==p?void 0:p.email)&&(null==m?void 0:m.id)&&k&&E({credentialsId:a,scope:"workspace",workspaceId:m.id,credentials:{data:{live:k.live,test:{publicKey:(0,G.hj)(k.test.publicKey)?k.test.publicKey:void 0,secretKey:(0,G.hj)(k.test.secretKey)?k.test.secretKey:void 0}},name:k.name,type:"stripe"}})};return(0,i.jsxs)(e3.$,{children:[(0,i.jsx)(e8.r,{children:u("blocks.inputs.payment.settings.stripeConfig.title.label")}),(0,i.jsx)(e6.s,{}),(0,i.jsxs)("form",{onSubmit:z,children:[(0,i.jsx)(e7.c,{children:(0,i.jsxs)(y.B,{as:"form",spacing:4,children:[(0,i.jsx)(e5.ks,{isRequired:!0,label:u("blocks.inputs.payment.settings.stripeConfig.accountName.label"),defaultValue:null==k?void 0:k.name,onChange:e=>k&&S({...k,name:e}),placeholder:"Typebot",withVariableButton:!1,debounceTimeout:0}),(0,i.jsxs)(y.B,{children:[(0,i.jsxs)(se.l,{children:[u("blocks.inputs.payment.settings.stripeConfig.testKeys.label")," ",(0,i.jsx)(e2.t,{children:u("blocks.inputs.payment.settings.stripeConfig.testKeys.infoText.label")})]}),(0,i.jsxs)(x.z,{children:[(0,i.jsx)(e5.ks,{onChange:e=>k&&S({...k,test:{...k.test,publicKey:e}}),placeholder:"pk_test_...",withVariableButton:!1,defaultValue:null==k||null==(s=k.test)?void 0:s.publicKey,debounceTimeout:0}),(0,i.jsx)(e5.ks,{onChange:e=>k&&S({...k,test:{...k.test,secretKey:e}}),placeholder:"sk_test_...",withVariableButton:!1,debounceTimeout:0,defaultValue:null==k||null==(n=k.test)?void 0:n.secretKey,type:"password"})]})]}),(0,i.jsxs)(y.B,{children:[(0,i.jsx)(se.l,{children:u("blocks.inputs.payment.settings.stripeConfig.liveKeys.label")}),(0,i.jsxs)(x.z,{children:[(0,i.jsx)(ss.MJ,{children:(0,i.jsx)(e5.ks,{onChange:e=>k&&S({...k,live:{...k.live,publicKey:e}}),placeholder:"pk_live_...",withVariableButton:!1,defaultValue:null==k||null==(t=k.live)?void 0:t.publicKey,debounceTimeout:0})}),(0,i.jsx)(ss.MJ,{children:(0,i.jsx)(e5.ks,{onChange:e=>k&&S({...k,live:{...k.live,secretKey:e}}),placeholder:"sk_live_...",withVariableButton:!1,defaultValue:null==k||null==(l=k.live)?void 0:l.secretKey,debounceTimeout:0,type:"password"})})]})]}),(0,i.jsxs)(j.E,{children:["(",u("blocks.inputs.payment.settings.stripeConfig.findKeys.label")," ",(0,i.jsx)(e9.Y,{href:"https://dashboard.stripe.com/apikeys",isExternal:!0,children:u("blocks.inputs.payment.settings.stripeConfig.findKeys.here.label")}),")"]})]})}),(0,i.jsx)(sn.j,{children:(0,i.jsx)(h.$,{type:"submit",colorScheme:"orange",isDisabled:(null==k?void 0:k.live.publicKey)===""||(null==k?void 0:k.name)===""||(null==k?void 0:k.live.secretKey)==="",isLoading:g,children:u("connect")})})]})]})};var st=n(20873),sl=n(3528),sa=n(48038);let sr=e=>{let{credentialsId:s,onUpdate:n}=e,{user:t}=(0,r.J)(),{workspace:l}=(0,o.h)(),[a,c]=(0,w.useState)(!1),[u,p]=(0,w.useState)(),{data:x}=(0,f.I)(d.id.credentials.getCredentials.queryOptions({scope:"workspace",workspaceId:l.id,credentialsId:s},{enabled:!!(null==l?void 0:l.id)}));(0,w.useEffect)(()=>{x&&!u&&p(x.data)},[x,u]);let{mutate:j}=(0,eu.n)(d.id.credentials.updateCredentials.mutationOptions({onSettled:()=>c(!1),onError:e=>{(0,st.o)({description:e.message})},onSuccess:()=>{n()}})),m=async e=>{if(e.preventDefault(),!(null==t?void 0:t.email)||!(null==l?void 0:l.id)||!u)return;c(!0);let{error:n}=await (0,sl.p)(u,t.email);n&&(c(!1),(0,st.o)({description:"We couldn't send the test email with your configuration"})),j({credentialsId:s,credentials:{data:u,name:u.from.email,type:"smtp"},scope:"workspace",workspaceId:l.id})};return(0,i.jsxs)(e3.$,{children:[(0,i.jsx)(e8.r,{children:"Update SMTP config"}),(0,i.jsx)(e6.s,{}),(0,i.jsxs)("form",{onSubmit:m,children:[(0,i.jsx)(e7.c,{children:(0,i.jsx)(sa.P,{config:u,onConfigChange:p})}),(0,i.jsx)(sn.j,{children:(0,i.jsx)(h.$,{type:"submit",colorScheme:"orange",isDisabled:(0,G.pN)(null==u?void 0:u.from.email)||(0,G.pN)(null==u?void 0:u.host)||(0,G.pN)(null==u?void 0:u.username)||(0,G.pN)(null==u?void 0:u.password)||(0,G.pN)(null==u?void 0:u.port),isLoading:a,children:"Update"})})]})]})};var so=n(38847),sc=n(68401);let sd=e=>{let{credentialsId:s,blockDef:n,onUpdate:t,scope:l}=e,{workspace:a}=(0,o.h)(),[r,c]=(0,w.useState)(""),[u,p]=(0,w.useState)(),[x,j]=(0,w.useState)(!1),{data:m,refetch:g}=(0,f.I)(d.id.credentials.getCredentials.queryOptions("workspace"===l?{scope:"workspace",workspaceId:null==a?void 0:a.id,credentialsId:s}:{scope:"user",credentialsId:s},{enabled:!!(null==a?void 0:a.id)}));(0,w.useEffect)(()=>{m&&!u&&(c(m.name),p(m.data))},[u,m]);let{mutate:b}=(0,eu.n)(d.id.credentials.updateCredentials.mutationOptions({onMutate:()=>j(!0),onSettled:()=>j(!1),onError:e=>{(0,st.o)({description:e.message})},onSuccess:()=>{t(),g()}})),v=async e=>{e.preventDefault(),a&&n.auth&&b("workspace"===l?{credentialsId:s,credentials:{type:n.id,name:null!=r?r:"My account",data:u},scope:"workspace",workspaceId:a.id}:{scope:"user",credentialsId:s,credentials:{type:n.id,name:null!=r?r:"My account",data:u}})};return n.auth?(0,i.jsxs)(e3.$,{children:[(0,i.jsxs)(e8.r,{children:["Update ",n.auth.name]}),(0,i.jsx)(e6.s,{}),(0,i.jsxs)("form",{onSubmit:v,children:[(0,i.jsxs)(e7.c,{as:y.B,spacing:"6",children:[(0,i.jsx)(so.k,{isRequired:!0,label:"Label",moreInfoTooltip:"Choose a name to identify this ".concat(n.auth.name),defaultValue:r,onChange:c,placeholder:"My account",withVariableButton:!1,debounceTimeout:0}),u&&"encryptedCredentials"===n.auth.type&&(0,i.jsx)(sc.p,{schema:n.auth.schema,data:u,onDataChange:p})]}),(0,i.jsx)(sn.j,{children:(0,i.jsx)(h.$,{type:"submit",isLoading:x,isDisabled:!u||0===Object.keys(u).length,colorScheme:"orange",children:"Update"})})]})]}):null};var su=n(70954),sp=n(81485),sh=n(91767),sx=n(96378),sj=n(10497),sm=n(59030);let sg=e=>{let{credentialsId:s,blockDef:n,scope:t,onUpdate:l}=e,{workspace:a}=(0,o.h)(),[r,c]=(0,w.useState)(""),[u,p]=(0,w.useState)(n.auth&&"defaultClientEnvKeys"in n.auth?"default":"your-app"),[h,x]=(0,w.useState)(""),[j,m]=(0,w.useState)(""),{data:g,refetch:b}=(0,f.I)(d.id.credentials.getCredentials.queryOptions("workspace"===t?{scope:"workspace",workspaceId:null==a?void 0:a.id,credentialsId:s}:{scope:"user",credentialsId:s},{enabled:!!(null==a?void 0:a.id)}));(0,w.useEffect)(()=>{if(g&&""===r&&""===h&&""===j&&(c(g.name),"client"in g.data&&g.data.client)){let e=g.data.client;x(e.id),m(e.secret),p("your-app")}},[g,h,j,r]);let{mutate:v,isPending:k}=(0,eu.n)(d.id.credentials.updateOAuthCredentials.mutationOptions({onError:e=>{(0,st.o)({description:e.message})},onSuccess:e=>{d.qQ.invalidateQueries({queryKey:d.id.credentials.listCredentials.queryKey()}),l()}})),S=async()=>{if(!a)return;window.open("/api/".concat(n.id,"/oauth/authorize?").concat((0,su.stringify)({clientId:h})),"oauthPopup","width=500,height=700");let e=i=>{var t;if((null==(t=i.data)?void 0:t.type)==="oauth"){window.removeEventListener("message",e);let{code:t}=i.data;v({name:r,blockType:n.id,workspaceId:a.id,credentialsId:s,code:t,customClient:"your-app"===u?{id:h,secret:j}:void 0})}};window.removeEventListener("message",e),window.addEventListener("message",e)};return n.auth?(0,i.jsxs)(e3.$,{children:[(0,i.jsxs)(e8.r,{children:["Add ",n.auth.name]}),(0,i.jsx)(e6.s,{}),(0,i.jsxs)(e7.c,{as:y.B,spacing:"4",children:[(0,i.jsx)(so.k,{label:"Label",moreInfoTooltip:"Choose a name to identify this ".concat(n.auth.name),onChange:c,defaultValue:r,placeholder:"My account",withVariableButton:!1,debounceTimeout:0}),"defaultClientEnvKeys"in n.auth?(0,i.jsxs)("div",{className:"flex gap-4 w-full items-center",children:[(0,i.jsx)("p",{children:"OAuth app"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(sm.$,{variant:"default"===u?"outline":"ghost",onClick:()=>p("default"),children:"Default"}),(0,i.jsx)(sm.$,{variant:"your-app"===u?"outline":"ghost",onClick:()=>p("your-app"),children:"Yours"})]})]}):null,"your-app"===u?(0,i.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,i.jsx)("span",{children:"Redirect URL"}),(0,i.jsx)(sf,{value:"".concat(document.location.origin,"/oauth/redirect")}),(0,i.jsx)(so.k,{label:"Client ID",onChange:x,defaultValue:h,withVariableButton:!1}),(0,i.jsx)(so.k,{type:"password",label:"Client secret",onChange:m,defaultValue:j,withVariableButton:!1})]}):null]}),(0,i.jsx)(sn.j,{children:(0,i.jsxs)(sm.$,{variant:"outline-secondary",onClick:S,disabled:!r||k||"your-app"===u&&(!h||!j),children:[(0,i.jsx)(n.LightLogo,{}),"Connect"]})})]}):null},sf=e=>{let{value:s}=e;return(0,i.jsxs)(sh.M,{children:[(0,i.jsx)(sx.p,{type:"text",value:s}),(0,i.jsx)(sj.t,{width:"60px",children:(0,i.jsx)(sp.i,{size:"sm",textToCopy:s})})]})};var sb=n(32263),sv=n(67039),sy=n(45273);let sw=e=>{let{editingCredentials:s,scope:n,onSubmit:t,onClose:l}=e;return(0,i.jsxs)(sb.aF,{isOpen:void 0!==s,onClose:l,children:[(0,i.jsx)(sv.m,{}),s&&(0,i.jsx)(sk,{editingCredentials:s,onSubmit:t,scope:n})]})},sk=e=>{var s;let{editingCredentials:n,scope:t,onSubmit:l}=e;return"google sheets"===n.type?null:"smtp"===n.type?(0,i.jsx)(sr,{credentialsId:n.id,onUpdate:l}):"stripe"===n.type?(0,i.jsx)(si,{credentialsId:n.id,onUpdate:l}):"whatsApp"===n.type?null:(null==(s=sy.S[n.type].auth)?void 0:s.type)==="oauth"?(0,i.jsx)(sg,{credentialsId:n.id,blockDef:sy.S[n.type],onUpdate:l,scope:t}):(0,i.jsx)(sd,{credentialsId:n.id,blockDef:sy.S[n.type],onUpdate:l,scope:t})},sS=["whatsApp","google sheets"],sC=()=>{let{t:e}=(0,b.WD)(),[s,n]=(0,w.useState)(),[t,a]=(0,w.useState)("workspace"),[r,c]=(0,w.useState)(),[j,v]=(0,w.useState)(),{workspace:k}=(0,o.h)(),{data:C,isLoading:E,refetch:z}=(0,f.I)(d.id.credentials.listCredentials.queryOptions("workspace"===t?{scope:"workspace",workspaceId:k.id}:{scope:"user"},{enabled:"user"===t||!!(null==k?void 0:k.id)})),{mutate:I}=(0,eu.n)(d.id.credentials.deleteCredentials.mutationOptions({onMutate:e=>{let{credentialsId:s}=e;return v(s)},onSettled:()=>{v(void 0)},onError:e=>{e1.oR.error(e.message)},onSuccess:()=>{z()}})),T=(0,w.useMemo)(()=>(null==C?void 0:C.credentials)?sT(C.credentials):void 0,[null==C?void 0:C.credentials]);return(0,i.jsxs)(y.B,{spacing:"6",w:"full",children:[(0,i.jsx)(e4.E,{scope:t,creatingType:s,onSubmit:()=>{z(),n(void 0)},onClose:()=>n(void 0)}),(0,i.jsx)(sw,{scope:t,editingCredentials:r,onSubmit:()=>{z(),c(void 0)},onClose:()=>c(void 0)}),(0,i.jsxs)(x.z,{justifyContent:"space-between",children:[(0,i.jsxs)(x.z,{children:[(0,i.jsx)(S.D,{fontSize:"2xl",children:e("credentials")}),(0,i.jsx)(Y.Q,{size:"sm",items:[{label:"User",value:"user"},{label:"Workspace",value:"workspace"}],currentItem:t,onItemSelect:e=>a(e)})]}),(0,i.jsxs)(u.W,{isLazy:!0,children:[(0,i.jsx)(p.I,{as:h.$,size:"sm",leftIcon:(0,i.jsx)(l.c1,{}),children:e("account.preferences.credentials.addButton.label")}),(0,i.jsx)(m.c,{children:e0.map(e=>(0,i.jsx)(g.D,{icon:(0,i.jsx)(sE,{type:e,boxSize:"16px"}),onClick:()=>n(e),children:(0,i.jsx)(sz,{type:e})},e))})]})]}),T&&!E?Object.keys(T).map(e=>(0,i.jsxs)(y.B,{borderWidth:"1px",borderRadius:"md",p:"4",spacing:4,"data-testid":e,children:[(0,i.jsxs)(x.z,{spacing:"3",children:[(0,i.jsx)(sE,{type:e,boxSize:"24px"}),(0,i.jsx)(sz,{type:e,fontWeight:"medium"})]}),(0,i.jsx)(y.B,{children:T[e].map(e=>(0,i.jsxs)(y.B,{children:[(0,i.jsx)(sI,{type:e.type,name:e.name,isDeleting:j===e.id,onEditClick:sS.includes(e.type)?void 0:()=>c({id:e.id,type:e.type}),onDeleteClick:()=>I("workspace"===t?{scope:"workspace",workspaceId:k.id,credentialsId:e.id}:{scope:"user",credentialsId:e.id})}),(0,i.jsx)(ei.c,{})]},e.id))})]},e)):(0,i.jsxs)(y.B,{borderRadius:"md",spacing:"6",children:[(0,i.jsxs)(y.B,{spacing:4,children:[(0,i.jsx)(et.Q,{}),(0,i.jsxs)(y.B,{children:[(0,i.jsx)(A.E,{height:"20px"}),(0,i.jsx)(A.E,{height:"20px"})]})]}),(0,i.jsxs)(y.B,{spacing:4,children:[(0,i.jsx)(et.Q,{}),(0,i.jsxs)(y.B,{children:[(0,i.jsx)(A.E,{height:"20px"}),(0,i.jsx)(A.E,{height:"20px"})]})]}),(0,i.jsxs)(y.B,{spacing:4,children:[(0,i.jsx)(et.Q,{}),(0,i.jsxs)(y.B,{children:[(0,i.jsx)(A.E,{height:"20px"}),(0,i.jsx)(A.E,{height:"20px"})]})]}),(0,i.jsxs)(y.B,{spacing:4,children:[(0,i.jsx)(et.Q,{}),(0,i.jsxs)(y.B,{children:[(0,i.jsx)(A.E,{height:"20px"}),(0,i.jsx)(A.E,{height:"20px"})]})]})]})]})},sE=e=>{let{type:s,...n}=e;switch(s){case"google sheets":return(0,i.jsx)(es.t,{type:ep.I.GOOGLE_SHEETS,...n});case"smtp":return(0,i.jsx)(es.t,{type:ep.I.EMAIL,...n});case"stripe":return(0,i.jsx)(Z,{rounded:"sm",...n});case"whatsApp":return(0,i.jsx)(ee.k,{...n});default:return(0,i.jsx)(es.t,{type:s,...n})}},sz=e=>{let{type:s,...n}=e;switch(s){case"google sheets":return(0,i.jsx)(j.E,{fontSize:"sm",...n,children:"Google Sheets"});case"smtp":return(0,i.jsx)(j.E,{fontSize:"sm",...n,children:"SMTP"});case"stripe":return(0,i.jsx)(j.E,{fontSize:"sm",...n,children:"Stripe"});case"whatsApp":return(0,i.jsx)(j.E,{fontSize:"sm",...n,children:"WhatsApp"});default:return(0,i.jsx)(en._M,{type:s,...n})}},sI=e=>{let{isDeleting:s,onEditClick:n,onDeleteClick:t,...a}=e,{t:r}=(0,b.WD)(),o=(0,w.useRef)(null);return(0,i.jsxs)(x.z,{justifyContent:"space-between",py:"2",children:[(0,i.jsx)(j.E,{fontSize:"sm",children:a.name}),(0,i.jsxs)(x.z,{children:[n&&(0,i.jsx)($.K,{"aria-label":"Edit",icon:(0,i.jsx)(l.qU,{}),size:"xs",onClick:n}),(0,i.jsx)(el.A,{isLazy:!0,initialFocusRef:o,children:e=>{let{onClose:n}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ea.W,{children:(0,i.jsx)($.K,{"aria-label":"Delete",icon:(0,i.jsx)(l.uc,{}),size:"xs"})}),(0,i.jsxs)(er.h,{children:[(0,i.jsx)(eo.R,{}),(0,i.jsx)(ec.e,{children:(0,i.jsxs)(y.B,{spacing:"2",children:[(0,i.jsx)(j.E,{fontSize:"sm",fontWeight:"medium",children:r("confirmModal.defaultTitle")}),(0,i.jsx)(j.E,{fontSize:"sm",children:r("account.preferences.credentials.deleteButton.confirmMessage")})]})}),(0,i.jsx)(ed.N,{as:V.s,justifyContent:"flex-end",children:(0,i.jsxs)(x.z,{children:[(0,i.jsx)(h.$,{ref:o,onClick:n,size:"sm",children:r("cancel")}),(0,i.jsx)(h.$,{colorScheme:"red",onClick:t,isLoading:s,size:"sm",children:r("delete")})]})})]})]})}})]})]})},sT=e=>{let s={};return e.forEach(e=>{s[e.type]||(s[e.type]=[]),s[e.type].push(e)}),s};var sD=n(10522),sB=n(40412),sM=n(82981),sL=n(27501);let sO=e=>{let{date:s}=e,n=Math.floor((new Date().getTime()-new Date(s).getTime())/1e3),t=n/31536e3;return t>1?(0,i.jsx)(b.T,{keyName:"timeSince.years",params:{count:Math.floor(t)}}):(t=n/2592e3)>1?(0,i.jsx)(b.T,{keyName:"timeSince.months",params:{count:Math.floor(t)}}):(t=n/86400)>1?(0,i.jsx)(b.T,{keyName:"timeSince.days",params:{count:Math.floor(t)}}):(t=n/3600)>1?(0,i.jsx)(b.T,{keyName:"timeSince.hours",params:{count:Math.floor(t)}}):(t=n/60)>1?(0,i.jsx)(b.T,{keyName:"timeSince.minutes",params:{count:Math.floor(t)}}):(0,i.jsx)(b.T,{keyName:"timeSince.seconds",params:{count:Math.floor(t)}})};var sW=n(15131),sK=n(98444),s$=n(10548),sN=n(2965);let sA=e=>{let{userId:s,onError:n}=e,{data:i,error:t,mutate:l}=(0,sN.Ay)(s?"/api/users/".concat(s,"/api-tokens"):null,sK.G,{dedupingInterval:s$._.NEXT_PUBLIC_E2E_TEST?0:void 0});return t&&n(t),{apiTokens:null==i?void 0:i.apiTokens,isLoading:!t&&!i,mutate:l}},s_=e=>{let{userId:s,tokenId:n}=e;return(0,G.w$)({url:"/api/users/".concat(s,"/api-tokens/").concat(n),method:"DELETE"})},sP=(e,s)=>{let{name:n}=s;return(0,G.w$)({url:"/api/users/".concat(e,"/api-tokens"),method:"POST",body:{name:n}})},sU=e=>{let{userId:s,isOpen:n,onClose:t,onNewToken:l}=e,a=(0,w.useRef)(null),{t:r}=(0,b.WD)(),[o,c]=(0,w.useState)(""),[d,u]=(0,w.useState)(!1),[p,x]=(0,w.useState)(),m=async e=>{e.preventDefault(),u(!0);let{data:n}=await sP(s,{name:o});(null==n?void 0:n.apiToken)&&(x(n.apiToken.token),l(n.apiToken)),u(!1)};return(0,i.jsxs)(sb.aF,{isOpen:n,onClose:t,initialFocusRef:a,children:[(0,i.jsx)(sv.m,{}),(0,i.jsxs)(e3.$,{children:[(0,i.jsx)(e8.r,{children:r(p?"account.apiTokens.createModal.createdHeading":"account.apiTokens.createModal.createHeading")}),(0,i.jsx)(e6.s,{}),p?(0,i.jsxs)(e7.c,{as:y.B,spacing:"4",children:[(0,i.jsxs)(j.E,{children:[r("account.apiTokens.createModal.copyInstruction")," ",(0,i.jsx)("strong",{children:r("account.apiTokens.createModal.securityWarning")})]}),(0,i.jsxs)(sh.M,{size:"md",children:[(0,i.jsx)(sx.p,{readOnly:!0,pr:"4.5rem",value:p}),(0,i.jsx)(sj.t,{width:"4.5rem",children:(0,i.jsx)(sp.i,{h:"1.75rem",size:"sm",textToCopy:p})})]})]}):(0,i.jsxs)(e7.c,{as:"form",onSubmit:m,children:[(0,i.jsx)(j.E,{mb:"4",children:r("account.apiTokens.createModal.nameInput.label")}),(0,i.jsx)(sx.p,{ref:a,placeholder:r("account.apiTokens.createModal.nameInput.placeholder"),onChange:e=>c(e.target.value)})]}),(0,i.jsx)(sn.j,{children:p?(0,i.jsx)(h.$,{onClick:t,colorScheme:"orange",children:r("account.apiTokens.createModal.doneButton.label")}):(0,i.jsx)(h.$,{colorScheme:"orange",isDisabled:0===o.length,isLoading:d,onClick:m,children:r("account.apiTokens.createModal.createButton.label")})})]})]})},sR=e=>{var s;let{user:n}=e,{t}=(0,b.WD)(),{apiTokens:l,isLoading:a,mutate:r}=sA({userId:n.id,onError:e=>(0,st.o)({context:"Failed to fetch tokens",description:e.message})}),{isOpen:o,onOpen:c,onClose:d}=(0,sW.j)(),[u,p]=(0,w.useState)(),x=async e=>{if(!l||!e)return;let{error:s}=await s_({userId:n.id,tokenId:e});s||r({apiTokens:l.filter(s=>s.id!==e)})};return(0,i.jsxs)(y.B,{spacing:4,children:[(0,i.jsx)(S.D,{fontSize:"2xl",children:t("account.apiTokens.heading")}),(0,i.jsx)(j.E,{children:t("account.apiTokens.description")}),(0,i.jsxs)(V.s,{justifyContent:"flex-end",children:[(0,i.jsx)(h.$,{onClick:c,children:t("account.apiTokens.createButton.label")}),(0,i.jsx)(sU,{userId:n.id,isOpen:o,onNewToken:e=>{l&&r({apiTokens:[e,...l]})},onClose:d})]}),(0,i.jsx)(D.K,{children:(0,i.jsxs)(B.X,{children:[(0,i.jsx)(M.d,{children:(0,i.jsxs)(L.Tr,{children:[(0,i.jsx)(O.Th,{children:t("account.apiTokens.table.nameHeader")}),(0,i.jsx)(O.Th,{w:"130px",children:t("account.apiTokens.table.createdHeader")}),(0,i.jsx)(O.Th,{w:"0"})]})}),(0,i.jsxs)(W.N,{children:[null==l?void 0:l.map(e=>(0,i.jsxs)(L.Tr,{children:[(0,i.jsx)(K.Td,{children:e.name}),(0,i.jsx)(K.Td,{children:(0,i.jsx)(sO,{date:e.createdAt})}),(0,i.jsx)(K.Td,{children:(0,i.jsx)(h.$,{size:"xs",colorScheme:"red",variant:"outline",onClick:()=>p(e.id),children:t("account.apiTokens.deleteButton.label")})})]},e.id)),a&&Array.from({length:3}).map((e,s)=>(0,i.jsxs)(L.Tr,{children:[(0,i.jsx)(K.Td,{children:(0,i.jsx)(N.S,{isDisabled:!0})}),(0,i.jsx)(K.Td,{children:(0,i.jsx)(A.E,{h:"5px"})}),(0,i.jsx)(K.Td,{children:(0,i.jsx)(A.E,{h:"5px"})})]},s))]})]})}),(0,i.jsx)(sL.u,{isOpen:(0,G.O9)(u),onConfirm:()=>x(u),onClose:()=>p(void 0),message:(0,i.jsx)(j.E,{children:(0,i.jsx)(b.T,{keyName:"account.apiTokens.deleteConfirmationMessage",params:{strong:(0,i.jsx)("strong",{children:null==l||null==(s=l.find((0,G.$H)(u)))?void 0:s.name})}})}),confirmButtonLabel:t("account.apiTokens.deleteButton.label")})]})},sV=()=>{var e,s,n,t;let{t:a}=(0,b.WD)(),{user:o,updateUser:c,updateLocalUserEmail:d}=(0,r.J)(),[u,p]=(0,w.useState)(null!=(e=null==o?void 0:o.name)?e:""),[m,g]=(0,w.useState)(!1),f=async e=>{c({image:e})};return(0,i.jsxs)(y.B,{spacing:"6",w:"full",overflowY:"auto",children:[(0,i.jsxs)(x.z,{spacing:6,children:[(0,i.jsx)(sM.e,{size:"lg",src:null!=(s=null==o?void 0:o.image)?s:void 0,name:null!=(n=null==o?void 0:o.name)?n:void 0}),(0,i.jsxs)(y.B,{children:[(null==o?void 0:o.id)&&(0,i.jsx)(sD.s,{size:"sm",fileType:"image",filePathProps:{userId:o.id,fileName:"avatar"},leftIcon:(0,i.jsx)(l.JM,{}),onFileUploaded:f,children:a("account.myAccount.changePhotoButton.label")}),(0,i.jsx)(j.E,{color:"gray.500",fontSize:"sm",children:a("account.myAccount.changePhotoButton.specification")})]})]}),(0,i.jsx)(so.k,{defaultValue:u,onChange:e=>{p(e),c({name:e})},label:a("account.myAccount.nameInput.label"),withVariableButton:!1,debounceTimeout:0}),o&&(0,i.jsxs)(x.z,{justifyContent:"space-between",children:[(0,i.jsxs)(y.B,{children:[(0,i.jsx)(j.E,{children:a("account.myAccount.emailInput.label")}),(0,i.jsx)(j.E,{size:"sm",color:"gray.500",children:null==o?void 0:o.email})]}),(0,i.jsx)(h.$,{onClick:()=>g(!0),children:"Change email"}),(0,i.jsx)(sq,{isOpen:m,onClose:e=>{g(!1),e&&d(e)},userEmail:null!=(t=null==o?void 0:o.email)?t:""})]}),o&&(0,i.jsx)(sR,{user:o})]})},sq=e=>{let{isOpen:s,onClose:n,userEmail:t}=e,{mutate:l}=(0,eu.n)(d.id.auth.sendUpdateEmailVerifCodeEmail.mutationOptions({onError:e=>{(0,st.o)({description:e.message}),x(void 0)},onSuccess:()=>{x("sent")}})),{mutate:a}=(0,eu.n)(d.id.auth.updateUserEmail.mutationOptions({onSettled:()=>{g(!1)},onError:e=>{(0,st.o)({description:e.message})},onSuccess:()=>{(0,sB.L)(),n(r)}})),[r,o]=(0,w.useState)(""),[c,u]=(0,w.useState)(""),[p,x]=(0,w.useState)(),[m,g]=(0,w.useState)(!1);return(0,i.jsxs)(sb.aF,{isOpen:s,onClose:()=>{o(""),u(""),x(void 0),g(!1),n()},isCentered:!0,size:"xl",children:[(0,i.jsx)(sv.m,{}),(0,i.jsx)(e3.$,{children:(0,i.jsxs)(e7.c,{py:6,gap:4,as:y.B,children:[(0,i.jsxs)(j.E,{children:["Your current email is:"," ",(0,i.jsx)(j.E,{as:"span",fontWeight:"bold",children:t})]}),(0,i.jsxs)(y.B,{as:"form",onSubmit:e=>{e.preventDefault(),x("sending"),l({newEmail:r})},children:[(0,i.jsx)(j.E,{children:"Please enter a new email and we will send you a verification code."}),(0,i.jsx)(sx.p,{type:"email",isDisabled:"sent"===p,value:r,onChange:e=>o(e.target.value),placeholder:"Enter new email"}),"sent"!==p&&(0,i.jsx)(h.$,{type:"submit",colorScheme:"orange",isDisabled:0===r.length,isLoading:"sending"===p,children:"Send verification code"})]}),"sent"===p&&(0,i.jsxs)(y.B,{as:"form",onSubmit:e=>{e.preventDefault(),g(!0),a({token:c})},children:[(0,i.jsxs)(j.E,{children:["We just sent a temporary verification code to"," ",(0,i.jsx)(j.E,{as:"span",fontWeight:"bold",children:r}),"."]}),(0,i.jsx)(sx.p,{value:c,onChange:e=>u(e.target.value),placeholder:"Enter verification code"}),(0,i.jsx)(h.$,{type:"submit",colorScheme:"orange",isDisabled:0===c.length,isLoading:m,children:"Change email"})]})]})})]})};var sF=n(12904);let sH={rE:"3.9.0"};var sG=n(69907),sJ=n(8121);let sQ=e=>{let{plan:s,customSeatsLimit:n}=e;return n||(s===z.cw.UNLIMITED||s===z.cw.CUSTOM?"inf":F.xM[s])},sY=e=>{var s,n;let{workspaceId:i}=e,{data:t,error:l,mutate:a}=(0,sN.Ay)(i?"/api/workspaces/".concat(i,"/members"):null,sK.G,{dedupingInterval:s$._.NEXT_PUBLIC_E2E_TEST?0:void 0});return{members:null!=(s=null==t?void 0:t.members)?s:[],invitations:null!=(n=null==t?void 0:t.invitations)?n:[],isLoading:!l&&!t,mutate:a}},sX=e=>(0,G.w$)({url:"/api/workspaces/".concat(e.workspaceId,"/invitations/").concat(e.id),method:"DELETE"}),sZ=(e,s)=>(0,G.w$)({method:"DELETE",url:"/api/workspaces/".concat(e,"/members/").concat(s)}),s0=e=>(0,G.w$)({url:"/api/workspaces/".concat(e.workspaceId,"/invitations/").concat(e.id),method:"PATCH",body:e}),s1=(e,s)=>(0,G.w$)({method:"PATCH",url:"/api/workspaces/".concat(e,"/members/").concat(s.userId),body:s}),s4=e=>(0,G.w$)({url:"/api/workspaces/".concat(e.workspaceId,"/invitations"),method:"POST",body:e}),s2=e=>{let{workspaceId:s,onNewMember:n,onNewInvitation:t,isLoading:l,isLocked:a}=e,{t:r}=(0,b.WD)(),[o,c]=(0,w.useState)(""),[d,u]=(0,w.useState)(z.KP.MEMBER),[p,j]=(0,w.useState)(!1),m=async e=>{e.preventDefault(),j(!0);let{data:i,error:l}=await s4({email:o,type:d,workspaceId:s});l?(0,st.o)({description:l.message,status:"error"}):c(""),(null==i?void 0:i.member)&&n(i.member),(null==i?void 0:i.invitation)&&t(i.invitation),j(!1)};return(0,i.jsxs)(x.z,{as:"form",onSubmit:m,children:[(0,i.jsx)(sx.p,{placeholder:r("workspace.membersList.inviteInput.placeholder"),name:"inviteEmail",value:o,onChange:e=>c(e.target.value),rounded:"md",isDisabled:a}),!a&&(0,i.jsx)(s9,{role:d,onChange:u}),(0,i.jsx)(h.$,{colorScheme:"orange",isLoading:p,flexShrink:0,type:"submit",isDisabled:l||a||""===o,children:r("workspace.membersList.inviteButton.label")})]})},s9=e=>{let{role:s,onChange:n}=e;return(0,i.jsxs)(u.W,{placement:"bottom",isLazy:!0,matchWidth:!0,children:[(0,i.jsx)(p.I,{flexShrink:0,as:h.$,rightIcon:(0,i.jsx)(l.YJ,{transform:"rotate(-90deg)"}),children:s5(s)}),(0,i.jsx)(m.c,{minW:0,children:(0,i.jsxs)(y.B,{maxH:"35vh",overflowY:"auto",spacing:"0",children:[(0,i.jsx)(g.D,{onClick:()=>n(z.KP.ADMIN),children:s5(z.KP.ADMIN)}),(0,i.jsx)(g.D,{onClick:()=>n(z.KP.MEMBER),children:s5(z.KP.MEMBER)})]})})]})},s5=e=>{switch(e){case z.KP.ADMIN:return"Admin";case z.KP.MEMBER:return"Member";case z.KP.GUEST:return"Guest"}};var s3=n(90869),s8=n(49942);let s6=e=>{let{email:s,name:n,image:t,role:l,isGuest:a=!1,isMe:r=!1,canEdit:o,onDeleteClick:c,onSelectNewRole:d}=e,{t:h}=(0,b.WD)();return(0,i.jsxs)(u.W,{placement:"bottom-end",isLazy:!0,children:[(0,i.jsx)(p.I,{_hover:{bg:(0,s3.dU)("gray.100","gray.700")},borderRadius:"md",children:(0,i.jsx)(s7,{email:s,name:n,image:t,isGuest:a,tag:s5(l)})}),!r&&o&&(0,i.jsxs)(m.c,{shadow:"md",children:[(0,i.jsx)(g.D,{onClick:()=>d(z.KP.ADMIN),children:s5(z.KP.ADMIN)}),(0,i.jsx)(g.D,{onClick:()=>d(z.KP.MEMBER),children:s5(z.KP.MEMBER)}),(0,i.jsx)(g.D,{color:"red.500",onClick:c,children:h("remove")})]})]})},s7=e=>{let{name:s,tag:n,isGuest:t=!1,image:l,email:a}=e,{t:r}=(0,b.WD)();return(0,i.jsxs)(x.z,{justifyContent:"space-between",maxW:"full",p:"2",children:[(0,i.jsxs)(x.z,{minW:0,spacing:"4",children:[(0,i.jsx)(sM.e,{name:s,src:l,size:"sm"}),(0,i.jsxs)(y.B,{spacing:0,minW:"0",children:[s&&(0,i.jsx)(j.E,{textAlign:"left",fontSize:"15px",children:s}),(0,i.jsx)(j.E,{color:"gray.500",fontSize:s?"14px":"inherit",noOfLines:1,children:a})]})]}),(0,i.jsxs)(x.z,{flexShrink:0,children:[t&&(0,i.jsx)(s8.vw,{color:"gray.400","data-testid":"tag",children:r("pending")}),(0,i.jsx)(s8.vw,{"data-testid":"tag",children:n})]})]})},ne=()=>{let{t:e}=(0,b.WD)(),{user:s}=(0,r.J)(),{workspace:n,currentUserMode:t}=(0,o.h)(),{members:l,invitations:a,isLoading:c,mutate:d}=sY({workspaceId:null==n?void 0:n.id}),u=e=>async()=>{n&&(await sZ(n.id,e),d({members:l.filter(s=>s.userId!==e),invitations:a}))},p=e=>async s=>{n&&(await s1(n.id,{userId:e,role:s}),d({members:l.map(n=>n.userId===e?{...n,role:s}:n),invitations:a}))},h=e=>async()=>{n&&(await sX({workspaceId:n.id,id:e}),d({invitations:a.filter(s=>s.id!==e),members:l}))},j=e=>async s=>{n&&(await s0({workspaceId:n.id,id:e,type:s}),d({invitations:a.map(n=>n.id===e?{...n,type:s}:n),members:l}))},m=async e=>{await d({members:l,invitations:[...a,e]})},g=async e=>{await d({members:[...l,e],invitations:a})},f=l.filter(e=>e.role!==z.KP.GUEST).length+a.length,v=n?sQ(n):void 0,w="inf"===v||!!v&&f<v;return(0,i.jsxs)(y.B,{w:"full",spacing:3,children:[!w&&(0,i.jsx)(sG.c,{children:e("workspace.membersList.unlockBanner.label")}),(0,G.O9)(v)&&(0,i.jsxs)(S.D,{fontSize:"2xl",children:[e("workspace.membersList.title")," ",-1===v?"":"(".concat(f,"/").concat(v,")")]}),(null==n?void 0:n.id)&&"write"===t&&(0,i.jsx)(s2,{workspaceId:n.id,onNewInvitation:m,onNewMember:g,isLoading:c,isLocked:!w}),l.map(e=>{var n,l,a;return(0,i.jsx)(s6,{email:null!=(n=e.email)?n:"",image:null!=(l=e.image)?l:void 0,name:null!=(a=e.name)?a:void 0,role:e.role,isMe:e.userId===(null==s?void 0:s.id),onDeleteClick:u(e.userId),onSelectNewRole:p(e.userId),canEdit:"write"===t},e.userId)}),a.map(e=>{var s;return(0,i.jsx)(s6,{email:null!=(s=e.email)?s:"",role:e.type,onDeleteClick:h(e.id),onSelectNewRole:j(e.id),isGuest:!0,canEdit:"write"===t},e.email)}),c&&(0,i.jsxs)(x.z,{py:"4",children:[(0,i.jsx)(et.Q,{boxSize:"32px"}),(0,i.jsx)(sJ.r,{width:"200px",noOfLines:2})]})]})};var ns=n(46769);let nn=e=>{let{onClose:s}=e,{t:n}=(0,b.WD)(),{workspace:t,workspaces:l,updateWorkspace:a,deleteCurrentWorkspace:r}=(0,o.h)(),c=async()=>{await r(),s()};return(0,i.jsxs)(y.B,{spacing:"6",w:"full",children:[(0,i.jsxs)(ss.MJ,{children:[(0,i.jsx)(se.l,{children:n("workspace.settings.icon.title")}),(0,i.jsx)(V.s,{children:t&&(0,i.jsx)(ns.a,{uploadFileProps:{workspaceId:t.id,fileName:"icon"},icon:t.icon,onChangeIcon:e=>a({icon:e}),boxSize:"40px"})})]}),t&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e5.ks,{label:n("workspace.settings.name.label"),withVariableButton:!1,defaultValue:null==t?void 0:t.name,onChange:e=>{(null==t?void 0:t.id)&&a({name:e})}}),(0,i.jsxs)(ss.MJ,{children:[(0,i.jsx)(se.l,{children:"ID:"}),(0,i.jsxs)(sh.M,{children:[(0,i.jsx)(sx.p,{type:"text",defaultValue:t.id,pr:"16",readOnly:!0}),(0,i.jsx)(sj.t,{width:"72px",children:(0,i.jsx)(sp.i,{textToCopy:t.id,size:"xs"})})]}),(0,i.jsx)(ss.eK,{children:n("workspace.settings.id.helperText")})]})]}),t&&l&&l.length>1&&(0,i.jsx)(ni,{onConfirm:c,workspaceName:null==t?void 0:t.name})]})},ni=e=>{let{workspaceName:s,onConfirm:n}=e,{t}=(0,b.WD)(),{isOpen:l,onOpen:a,onClose:r}=(0,sW.j)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h.$,{colorScheme:"red",variant:"outline",onClick:a,children:t("workspace.settings.deleteButton.label")}),(0,i.jsx)(sL.u,{isOpen:l,onConfirm:n,onClose:r,message:(0,i.jsx)(j.E,{children:t("workspace.settings.deleteButton.confirmMessage",{workspaceName:s})}),confirmButtonLabel:"Delete"})]})},nt=e=>{var s,n,r;let{isOpen:c,user:d,workspace:u,defaultTab:p="my-account",onClose:x}=e,{t:m}=(0,b.WD)(),{ref:g}=(0,a.Z)(),{currentUserMode:f}=(0,o.h)(),[v,k]=(0,w.useState)(p);return(0,i.jsxs)(sb.aF,{isOpen:c,onClose:x,size:"6xl",children:[(0,i.jsx)(sv.m,{}),(0,i.jsxs)(e3.$,{minH:"600px",flexDir:"row",ref:g,children:[(0,i.jsxs)(y.B,{spacing:8,w:"250px",py:"6",borderRightWidth:1,justifyContent:"space-between",children:[(0,i.jsxs)(y.B,{spacing:8,children:[(0,i.jsxs)(y.B,{children:[(0,i.jsx)(j.E,{pl:"4",color:"gray.500",fontSize:"sm",children:m("account")}),(0,i.jsx)(h.$,{variant:"my-account"===v?"solid":"ghost",onClick:()=>k("my-account"),leftIcon:(0,i.jsx)(sM.e,{name:null!=(s=d.name)?s:void 0,src:null!=(n=d.image)?n:void 0,boxSize:"15px"}),size:"sm",justifyContent:"flex-start",pl:"4",children:null!=(r=d.name)?r:d.email}),(0,i.jsx)(h.$,{variant:"user-settings"===v?"solid":"ghost",onClick:()=>k("user-settings"),leftIcon:(0,i.jsx)(l.Ze,{}),size:"sm",justifyContent:"flex-start",pl:"4",children:m("workspace.settings.modal.menu.preferences.label")}),(0,i.jsx)(h.$,{variant:"credentials"===v?"solid":"ghost",onClick:()=>k("credentials"),leftIcon:(0,i.jsx)(l.lc,{}),size:"sm",justifyContent:"flex-start",pl:"4",children:m("credentials")})]}),(0,i.jsxs)(y.B,{children:[(0,i.jsx)(j.E,{pl:"4",color:"gray.500",fontSize:"sm",children:m("workspace.settings.modal.menu.workspace.label")}),"write"===f&&(0,i.jsx)(h.$,{variant:"workspace-settings"===v?"solid":"ghost",onClick:()=>k("workspace-settings"),leftIcon:(0,i.jsx)(t.e,{icon:u.icon,boxSize:"15px",defaultIcon:l.jj}),size:"sm",justifyContent:"flex-start",pl:"4",children:m("workspace.settings.modal.menu.settings.label")}),"guest"!==f&&(0,i.jsx)(h.$,{variant:"members"===v?"solid":"ghost",onClick:()=>k("members"),leftIcon:(0,i.jsx)(l.LE,{}),size:"sm",justifyContent:"flex-start",pl:"4",children:m("workspace.settings.modal.menu.members.label")}),"write"===f&&(0,i.jsx)(h.$,{variant:"billing"===v?"solid":"ghost",onClick:()=>k("billing"),leftIcon:(0,i.jsx)(l.BF,{}),size:"sm",justifyContent:"flex-start",pl:"4",overflow:"auto",children:m("workspace.settings.modal.menu.billingAndUsage.label")})]})]}),(0,i.jsx)(V.s,{justify:"center",pt:"10",children:(0,i.jsx)(j.E,{color:"gray.500",fontSize:"xs",children:m("workspace.settings.modal.menu.version.label",{version:sH.rE})})})]}),c&&(0,i.jsx)(V.s,{flex:"1",p:"10",children:(0,i.jsx)(nl,{tab:v,onClose:x})})]})]})},nl=e=>{let{tab:s,onClose:n}=e;switch(s){case"my-account":return(0,i.jsx)(sV,{});case"user-settings":return(0,i.jsx)(sF.O,{});case"workspace-settings":return(0,i.jsx)(nn,{onClose:n});case"members":return(0,i.jsx)(ne,{});case"billing":return(0,i.jsx)(Q,{});case"credentials":return(0,i.jsx)(sC,{});default:return null}};var na=n(81278);let nr=()=>{let{t:e}=(0,b.WD)(),{user:s,logOut:n}=(0,r.J)(),{workspace:c,switchWorkspace:d,createWorkspace:u}=(0,o.h)(),{asPath:p}=(0,na.useRouter)(),[j,m]=(0,w.useState)(!1),g=p.includes("credentials"),{isOpen:f,onOpen:y,onClose:k}=(0,sW.j)({defaultIsOpen:g});return(0,i.jsx)(V.s,{w:"full",borderBottomWidth:"1px",justify:"center",bg:(0,s3.dU)("white","gray.900"),children:(0,i.jsxs)(V.s,{justify:"space-between",alignItems:"center",h:"16",maxW:"1000px",flex:"1",children:[(0,i.jsx)(P(),{href:"/typebots","data-testid":"typebot-logo",children:(0,i.jsx)(t.e,{boxSize:"30px",icon:null==c?void 0:c.icon,defaultIcon:l.jj})}),(0,i.jsxs)(x.z,{children:[s&&c&&!c.isPastDue&&(0,i.jsx)(a.f,{children:(0,i.jsx)(nt,{isOpen:f,onClose:k,user:s,workspace:c,defaultTab:g?"credentials":void 0})}),!(null==c?void 0:c.isPastDue)&&(0,i.jsx)(h.$,{leftIcon:(0,i.jsx)(l.Ze,{}),onClick:y,isLoading:(0,G.pN)(c)||j,children:e("dashboard.header.settingsButton.label")}),(0,i.jsx)(v,{isLoggingOut:j,currentWorkspace:c,onLogoutClick:()=>{m(!0),n()},onCreateNewWorkspaceClick:()=>{var e;return u(null!=(e=null==s?void 0:s.name)?e:void 0)},onWorkspaceSelected:d})]})]})})}},69907:(e,s,n)=>{n.d(s,{c:()=>d});var i=n(6029),t=n(996),l=n(15131),a=n(38859),r=n(28144),o=n(70205),c=n(94283);n(55729);let d=e=>{let{type:s,excludedPlans:n,...d}=e,{isOpen:u,onClose:p}=(0,l.j)();return(0,i.jsxs)(a.F,{status:"info",rounded:"md",justifyContent:"space-between",flexShrink:0,...d,children:[(0,i.jsxs)(r.z,{children:[(0,i.jsx)(o._,{}),(0,i.jsx)(c.E,{children:d.children})]}),(0,i.jsx)(t.L,{isOpen:u,onClose:p,type:s,excludedPlans:n})]})}}}]);