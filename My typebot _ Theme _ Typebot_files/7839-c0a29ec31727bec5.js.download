try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},s=(new e.Error).stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="c2f57389-7af2-4a60-a272-1cd650d09a3c",e._sentryDebugIdIdentifier="sentry-dbid-c2f57389-7af2-4a60-a272-1cd650d09a3c")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7839],{4227:(e,s,t)=>{t.d(s,{a:()=>c,r:()=>a});var n=t(6029),r=t(49942),i=t(13808);let a={[i.cw.LIFETIME]:"purple",[i.cw.PRO]:"purple",[i.cw.OFFERED]:"orange",[i.cw.STARTER]:"orange",[i.cw.FREE]:"gray",[i.cw.CUSTOM]:"yellow",[i.cw.UNLIMITED]:"yellow",[i.cw.ENTERPRISE]:"yellow"},c=e=>{let{plan:s,...t}=e;switch(s){case i.cw.LIFETIME:return(0,n.jsx)(r.vw,{colorScheme:a[s],"data-testid":"lifetime-plan-tag",...t,children:"Lifetime"});case i.cw.PRO:return(0,n.jsx)(r.vw,{colorScheme:a[s],"data-testid":"pro-plan-tag",...t,children:"Pro"});case i.cw.OFFERED:case i.cw.STARTER:return(0,n.jsx)(r.vw,{colorScheme:a[s],"data-testid":"starter-plan-tag",...t,children:"Starter"});case i.cw.FREE:return(0,n.jsx)(r.vw,{colorScheme:a[i.cw.FREE],"data-testid":"free-plan-tag",...t,children:"Free"});case i.cw.CUSTOM:return(0,n.jsx)(r.vw,{colorScheme:a[i.cw.CUSTOM],"data-testid":"custom-plan-tag",...t,children:"Custom"});case i.cw.UNLIMITED:return(0,n.jsx)(r.vw,{colorScheme:a[i.cw.UNLIMITED],"data-testid":"custom-unlimite-tag",...t,children:"Unlimited"});case i.cw.ENTERPRISE:return(0,n.jsx)(r.vw,{colorScheme:a[i.cw.ENTERPRISE],...t,children:"Enterprise"})}}},6856:(e,s,t)=>{t.d(s,{h:()=>n});let n=async e=>{let{err:s,context:t}=e;try{if("string"==typeof s)return{context:t,description:s,details:void 0};if(s instanceof Error){if("response"in s&&"object"==typeof s.response&&s.response&&"text"in s.response&&"function"==typeof s.response.text)return{context:t,description:s.message,details:JSON.stringify(await s.response.text())};return{context:t,description:s.message,details:"string"==typeof s.cause?s.cause:JSON.stringify(s.cause)}}return{context:t,description:JSON.stringify(s)}}catch(e){return{context:t,description:"Unknown error (failed to parse)"}}}},88053:(e,s,t)=>{t.d(s,{Q:()=>Y,b:()=>H});var n=t(6029),r=t(81485),i=t(37191),a=t(44444),c=t(38847),o=t(47827),l=t(59309),d=t(20873),h=t(32263),p=t(67039),u=t(32796),x=t(50427),j=t(57470),m=t(28144),w=t(58972),g=t(85678),y=t(7959),f=t(86747),k=t(29328),b=t(95281),E=t(98293),I=t(79813),S=t(23996),v=t(80636),C=t(99412),T=t(66425),N=t(2486),_=t(87505),R=t(31445),A=t(22070),P=t(94283),z=t(30083),U=t(49891),D=t(88131),M=t(45181),O=t(91767),q=t(96378),F=t(10497),L=t(26739),W=t(12482),B=t(16932),V=t(59217),J=t(10548),Q=t(6856),X=t(2283),$=t(55729);let G=[{title:"Requirements"},{title:"User Token"},{title:"Phone Number"},{title:"Webhook"}],K=(0,L.sX)(),Y=e=>{let{isOpen:s,onClose:t,onNewCredentials:r}=e;return(0,n.jsxs)(h.aF,{isOpen:s,onClose:t,size:"3xl",children:[(0,n.jsx)(p.m,{}),(0,n.jsx)(H,{onNewCredentials:r,onClose:t})]})},H=e=>{let{onNewCredentials:s,onClose:t}=e,{workspace:r}=(0,o.h)(),{activeStep:i,goToNext:c,goToPrevious:h,setActiveStep:p}=(0,u.f)({index:0,count:G.length}),[P,z]=(0,$.useState)(""),[U,D]=(0,$.useState)(""),[M,O]=(0,$.useState)(""),[q,F]=(0,$.useState)(""),[L,J]=(0,$.useState)(!1),[Y,H]=(0,$.useState)(!1),{mutate:en}=(0,B.n)(l.id.credentials.createCredentials.mutationOptions({onMutate:()=>H(!0),onSettled:()=>H(!1),onError:e=>{(0,d.o)({description:e.message})},onSuccess:e=>{l.qQ.invalidateQueries({queryKey:l.id.credentials.listCredentials.queryKey({workspaceId:null==r?void 0:r.id})}),s(e.credentialsId),t(),ei()}})),{data:er}=(0,W.I)(l.id.whatsAppInternal.getSystemTokenInfo.queryOptions({token:P},{enabled:(0,X.hj)(P)})),ei=()=>{p(0),z(""),D("")},ea=async()=>{r&&en({scope:"workspace",workspaceId:r.id,credentials:{id:K,type:"whatsApp",name:M,data:{systemUserAccessToken:P,phoneNumberId:U}}})},ec=async()=>{J(!0);try{let{expiresAt:e,scopes:s}=await l.rP.whatsAppInternal.getSystemTokenInfo.query({token:P});if(0!==e)return(0,d.o)({description:"Token expiration was not set to *never*. Create the token again with the correct expiration."}),!1;if(["whatsapp_business_management","whatsapp_business_messaging"].find(e=>!s.includes(e)))return(0,d.o)({description:"Token does not have all the necessary scopes"}),!1}catch(s){if(J(!1),s instanceof V.HN){var e;if(null==(e=s.data)?void 0:e.logError)return(0,d.o)(s.data.logError),!1}return(0,d.o)(await (0,Q.h)({err:s})),!1}return J(!1),!0},eo=async()=>{J(!0);try{let{name:e}=await l.rP.whatsAppInternal.getPhoneNumber.query({systemToken:P,phoneNumberId:U});O(e);try{let{message:s}=await l.rP.whatsAppInternal.verifyIfPhoneNumberAvailable.query({phoneNumberDisplayName:e});if("taken"===s)return J(!1),(0,d.o)({description:"Phone number is already registered on Typebot"}),!1;let{verificationToken:t}=await l.rP.whatsAppInternal.generateVerificationToken.mutate();F(t)}catch(e){return console.error(e),J(!1),(0,d.o)({description:"Could not verify if phone number is available"}),!1}}catch(s){if(J(!1),s instanceof V.HN){var e;if(null==(e=s.data)?void 0:e.logError)return(0,d.o)(s.data.logError),!1}return console.error(s),(0,d.o)(await (0,Q.h)({err:s})),!1}return J(!1),!0},el=async()=>{if(i===G.length-1)return ea();(1!==i||await ec())&&(2!==i||await eo())&&c()};return(0,n.jsxs)(x.$,{children:[(0,n.jsx)(j.r,{children:(0,n.jsxs)(m.z,{h:"40px",children:[i>0&&(0,n.jsx)(w.K,{icon:(0,n.jsx)(a.YJ,{}),"aria-label":"Go back",variant:"ghost",onClick:h}),(0,n.jsx)(g.D,{size:"md",children:"Add a WhatsApp phone number"})]})}),(0,n.jsx)(y.s,{}),(0,n.jsxs)(f.c,{as:k.B,spacing:"10",children:[(0,n.jsx)(b.C,{index:i,size:"sm",pt:"4",children:G.map((e,s)=>(0,n.jsxs)(E.p,{children:[(0,n.jsx)(I.S,{children:(0,n.jsx)(S.x,{complete:(0,n.jsx)(v.W,{}),incomplete:(0,n.jsx)(C.Q,{}),active:(0,n.jsx)(C.Q,{})})}),(0,n.jsx)(T.az,{flexShrink:"0",children:(0,n.jsx)(N.J,{children:e.title})}),(0,n.jsx)(_.m,{})]},s))}),0===i&&(0,n.jsx)(Z,{}),1===i&&(0,n.jsx)(ee,{initialToken:P,setToken:z}),2===i&&(0,n.jsx)(es,{appId:null==er?void 0:er.appId,initialPhoneNumberId:U,setPhoneNumberId:D}),3===i&&(0,n.jsx)(et,{appId:null==er?void 0:er.appId,verificationToken:q,credentialsId:K})]}),(0,n.jsx)(R.j,{children:(0,n.jsx)(A.$,{onClick:el,colorScheme:"orange",isDisabled:1===i&&(0,X.Im)(P)||2===i&&(0,X.Im)(U),isLoading:L||Y,children:i===G.length-1?"Submit":"Continue"})})]})},Z=()=>(0,n.jsxs)(k.B,{spacing:4,children:[(0,n.jsxs)(P.E,{children:["Make sure you have"," ",(0,n.jsx)(i.Y,{href:"https://docs.typebot.io/deploy/whatsapp/create-meta-app",isExternal:!0,children:"created a WhatsApp Meta app"}),". You should be able to get to this page:"]}),(0,n.jsx)(z._,{src:"/images/whatsapp-quickstart-page.png",alt:"WhatsApp quickstart page",rounded:"md"})]}),ee=e=>{let{initialToken:s,setToken:t}=e;return(0,n.jsxs)(U._J,{spacing:4,children:[(0,n.jsxs)(U.ck,{children:["Go to your"," ",(0,n.jsx)(A.$,{as:D.N,href:"https://business.facebook.com/settings/system-users",isExternal:!0,rightIcon:(0,n.jsx)(a.pT,{}),size:"sm",children:"System users page"})]}),(0,n.jsxs)(U.ck,{children:["Create a new user by clicking on ",(0,n.jsx)(M.C,{children:"Add"})]}),(0,n.jsxs)(U.ck,{children:["Fill it with any name and give it the ",(0,n.jsx)(M.C,{children:"Admin"})," role"]}),(0,n.jsx)(U.ck,{children:(0,n.jsxs)(k.B,{children:[(0,n.jsxs)(P.E,{children:["Click on ",(0,n.jsx)(M.C,{children:"Add assets"}),". Under ",(0,n.jsx)(M.C,{children:"Apps"}),", look for your previously created app, select it and check"," ",(0,n.jsx)(M.C,{children:"Manage app"})]}),(0,n.jsx)(z._,{src:"/images/meta-system-user-assets.png",alt:"Meta system user assets",rounded:"md"})]})}),(0,n.jsx)(U.ck,{children:(0,n.jsxs)(k.B,{spacing:4,children:[(0,n.jsxs)(P.E,{children:["Now, click on ",(0,n.jsx)(M.C,{children:"Generate new token"}),". Select your app."]}),(0,n.jsxs)(U.Xy,{spacing:4,children:[(0,n.jsxs)(U.ck,{children:["Token expiration: ",(0,n.jsx)(M.C,{children:"Never"})]}),(0,n.jsxs)(U.ck,{children:["Available Permissions: ",(0,n.jsx)(M.C,{children:"whatsapp_business_messaging"}),","," ",(0,n.jsx)(M.C,{children:"whatsapp_business_management"})," "]})]})]})}),(0,n.jsx)(U.ck,{children:"Copy and paste the generated token:"}),(0,n.jsx)(c.k,{isRequired:!0,type:"password",label:"System User Token",defaultValue:s,onChange:e=>t(e.trim()),withVariableButton:!1,debounceTimeout:0})]})},es=e=>{let{appId:s,initialPhoneNumberId:t,setPhoneNumberId:r}=e;return(0,n.jsxs)(U._J,{spacing:4,children:[(0,n.jsx)(U.ck,{children:(0,n.jsx)(m.z,{children:(0,n.jsxs)(P.E,{children:["Go to your"," ",(0,n.jsxs)(A.$,{as:D.N,href:"https://developers.facebook.com/apps/".concat(s,"/whatsapp-business/wa-dev-console"),isExternal:!0,rightIcon:(0,n.jsx)(a.pT,{}),size:"sm",children:["WhatsApp Dev Console"," "]})]})})}),(0,n.jsxs)(U.ck,{children:["Add your phone number by clicking on the ",(0,n.jsx)(M.C,{children:"Add phone number"})," ","button."]}),(0,n.jsx)(U.ck,{children:(0,n.jsxs)(k.B,{children:[(0,n.jsxs)(P.E,{children:["Select a phone number and paste the associated"," ",(0,n.jsx)(M.C,{children:"Phone number ID"})]}),(0,n.jsx)(m.z,{children:(0,n.jsx)(c.k,{label:"Phone number ID",defaultValue:t,withVariableButton:!1,debounceTimeout:0,isRequired:!0,onChange:r})}),(0,n.jsx)(z._,{src:"/images/whatsapp-phone-selection.png",alt:"WA phone selection"})]})})]})},et=e=>{var s;let{appId:t,verificationToken:i,credentialsId:c}=e,{workspace:l}=(0,o.h)(),d="".concat(null!=(s=J._.NEXT_PUBLIC_VIEWER_URL.at(1))?s:J._.NEXT_PUBLIC_VIEWER_URL[0],"/api/v1/workspaces/").concat(null==l?void 0:l.id,"/whatsapp/").concat(c,"/webhook");return(0,n.jsxs)(k.B,{spacing:6,children:[(0,n.jsxs)(P.E,{children:["In your"," ",(0,n.jsx)(A.$,{as:D.N,href:"https://developers.facebook.com/apps/".concat(t,"/whatsapp-business/wa-settings"),rightIcon:(0,n.jsx)(a.pT,{}),isExternal:!0,size:"sm",children:"WhatsApp Settings page"}),", click on the Edit button and insert the following values:"]}),(0,n.jsxs)(U.Xy,{spacing:6,children:[(0,n.jsx)(U.ck,{children:(0,n.jsxs)(m.z,{children:[(0,n.jsx)(P.E,{flexShrink:0,children:"Callback URL:"}),(0,n.jsxs)(O.M,{size:"sm",children:[(0,n.jsx)(q.p,{type:"text",defaultValue:d}),(0,n.jsx)(F.t,{width:"60px",children:(0,n.jsx)(r.i,{size:"sm",textToCopy:d})})]})]})}),(0,n.jsx)(U.ck,{children:(0,n.jsxs)(m.z,{children:[(0,n.jsx)(P.E,{flexShrink:0,children:"Verify Token:"}),(0,n.jsxs)(O.M,{size:"sm",children:[(0,n.jsx)(q.p,{type:"text",defaultValue:i}),(0,n.jsx)(F.t,{width:"60px",children:(0,n.jsx)(r.i,{size:"sm",textToCopy:i})})]})]})}),(0,n.jsx)(U.ck,{children:(0,n.jsx)(m.z,{children:(0,n.jsxs)(P.E,{flexShrink:0,children:["Webhook fields: Next to ",(0,n.jsx)(M.C,{children:"messages"}),', click on "Subscribe"']})})})]})]})}}}]);